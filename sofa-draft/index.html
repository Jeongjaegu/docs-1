<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui">
    <title>SOFA Overview</title>
    <link type="text/css" rel="stylesheet" href="assets/css/github-markdown.css">
    <link type="text/css" rel="stylesheet" href="assets/css/pilcrow.css">
    <link type="text/css" rel="stylesheet" href="assets/css/hljs-github.min.css"/>
  </head>
  <body>
    <article class="markdown-body"><h1 id="sofa-overview"><a class="header-link" href="#sofa-overview"></a>SOFA Overview</h1>
<p>SOFA describes special messages that ride along inside text-based conversational communications
providing machine-readable actions, notifications and intents for interaction with the Ethereum
network.</p>
<p>In the context of Token, they are sent between users, or between users and bots.</p>
<h2 id="public-manifest"><a class="header-link" href="#public-manifest"></a>Public Manifest</h2>
<p>SOFA clients that are intended to accept communications publicly (such as a chatbot app)
should provide a JSON manifest publicly available via HTTP GET request. This manifest is
used by browsers to decide how to present your SOFA app to the user.</p>
<p>Example manifest:</p>
<pre class="hljs"><code>{
  <span class="hljs-attr">"displayName"</span>: <span class="hljs-string">"TokenBot"</span>,
  <span class="hljs-attr">"versions"</span>: [<span class="hljs-string">"sofaV1"</span>],
  <span class="hljs-attr">"avatarUrl"</span>: <span class="hljs-string">"http://static-assets.tokenapp.com/avatar.png"</span>,
  <span class="hljs-attr">"interfaces"</span>: [<span class="hljs-string">"Chatbot"</span>],
  <span class="hljs-attr">"languages"</span>: [<span class="hljs-string">"en"</span>],
  <span class="hljs-attr">"ethereumAddress"</span>: <span class="hljs-string">"0x..."</span>,
  <span class="hljs-attr">"requiresIntroduction"</span>: <span class="hljs-literal">true</span>
}</code></pre><h2 id="messages"><a class="header-link" href="#messages"></a>Messages</h2>
<p>SOFA messages are plain text JSON payloads, with a special prefix that identifies the message type.
The prefix takes the form:</p>
<p><code>namespace::type:</code></p>
<p>For instance:</p>
<pre class="hljs"><code>SOFA::TxStatusChange:{
  <span class="hljs-attr">"status"</span>: Pending,
  <span class="hljs-attr">"txHash"</span>: <span class="hljs-string">"0x..."</span>,
  <span class="hljs-attr">"value"</span>: <span class="hljs-string">"0.01"</span>
}</code></pre><h2 id="message-usage-examples"><a class="header-link" href="#message-usage-examples"></a>Message Usage Examples</h2>
<h3 id="initialize"><a class="header-link" href="#initialize"></a>Initialize</h3>
<p>When a client speaks to a SOFA app for the first time, the first message should be
of type Initialize, which provides context for the bot about who it is speaking to.</p>
<pre class="hljs"><code>SOFA::Initialize:{
  <span class="hljs-attr">"paymentAddress"</span>: <span class="hljs-string">"0xa2a0134f1df987bc388dbcb635dfeed4ce497e2a"</span>,
  <span class="hljs-attr">"username"</span>: <span class="hljs-string">"mark"</span>
}</code></pre><h3 id="initializationrequest"><a class="header-link" href="#initializationrequest"></a>InitializationRequest</h3>
<p>If an Initialize message has not been sent, or needs to be re-sent, a bot may send
an InitializationRequest message, which should trigger the client to send an Initialize
message.</p>
<pre class="hljs"><code>SOFA::InitializationRequest:{
  <span class="hljs-attr">"message"</span>: <span class="hljs-string">"I don't who you are!"</span>
}</code></pre><h3 id="txrequest"><a class="header-link" href="#txrequest"></a>TxRequest</h3>
<p>Request money from message recipient. This message contains all information required
to execute payment if approved by recipient.</p>
<pre class="hljs"><code>SOFA::TxRequest:{
  <span class="hljs-attr">"currency"</span>: <span class="hljs-string">"USD"</span>,
  <span class="hljs-attr">"value"</span>: <span class="hljs-number">0.01</span>,
  <span class="hljs-attr">"destinationAddress"</span>: <span class="hljs-string">"0x056db290f8ba3250ca64a45d16284d04bc6f5fbf"</span>
}</code></pre><h3 id="txstatuschange"><a class="header-link" href="#txstatuschange"></a>TxStatusChange</h3>
<p>Notification of status change for Ethereum transaction. Only trustworthy when coming from
a trusted source. It is still useful from untrusted sources for triggering the recipient
to check the validity of the transaction/status on the Ethereum network.</p>
<pre class="hljs"><code>SOFA::TxStatusChange:{
  <span class="hljs-attr">"status"</span>: <span class="hljs-string">"pending"</span>,
  <span class="hljs-attr">"txHash"</span>: <span class="hljs-string">"0x..."</span>,
  <span class="hljs-attr">"value"</span>: <span class="hljs-string">"0.01"</span>
}</code></pre><h3 id="question"><a class="header-link" href="#question"></a>Question</h3>
<p>Pose a question and suggest (or require) certain answers/actions. Clients should go into a
&quot;question answering&quot; state upon receipt of this question, rendering the responses as appropriate
and enabling/disabling custom typed text responses.</p>
<p>Example: Single choice list, no custom response</p>
<pre class="hljs"><code>SOFA::Question:{
  <span class="hljs-attr">"question"</span>: <span class="hljs-string">"Now letâ€™s try sending some money. Choose a charity to make a donation of $0.01."</span>,
  <span class="hljs-attr">"allowCustom"</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">"responses"</span>: [
    {<span class="hljs-attr">"label"</span>: <span class="hljs-string">"Red Cross"</span>},
    {<span class="hljs-attr">"label"</span>: <span class="hljs-string">"Ethereum foundation"</span>},
    {<span class="hljs-attr">"label"</span>: <span class="hljs-string">"GiveWell.org"</span>},
    {<span class="hljs-attr">"label"</span>: <span class="hljs-string">"Not now, thanks"</span>, <span class="hljs-attr">"role"</span>: <span class="hljs-string">"negative"</span>}
  ]
}</code></pre><p>Example: Yes/No question</p>
<pre class="hljs"><code>SOFA::Question:{
  <span class="hljs-attr">"question"</span>: <span class="hljs-string">"Would you like to recieve notifications?"</span>,
  <span class="hljs-attr">"allowCustom"</span>: no,
  <span class="hljs-attr">"responses"</span>: [
    {<span class="hljs-attr">"label"</span>: <span class="hljs-string">"Sure!"</span>, <span class="hljs-attr">"role"</span>: <span class="hljs-string">"affirmative"</span>},
    {<span class="hljs-attr">"label"</span>: <span class="hljs-string">"No thanks"</span>, <span class="hljs-attr">"role"</span>: <span class="hljs-string">"negative"</span>}
  ]
}</code></pre><p>Example: Question with prefilled common responses, and ability for custom text responses
that the bot will attempt to understand</p>
<pre class="hljs"><code>SOFA::Question:{
  <span class="hljs-attr">"question"</span>: <span class="hljs-string">"Great! Now that we've set that up, how often do you want to recieve reminders?"</span>,
  <span class="hljs-attr">"allowCustom"</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">"responses"</span>: [
    {<span class="hljs-attr">"label"</span>: <span class="hljs-string">"Never"</span>},
    {<span class="hljs-attr">"label"</span>: <span class="hljs-string">"Once per day"</span>},
    {<span class="hljs-attr">"label"</span>: <span class="hljs-string">"Twice per day"</span>},
    {<span class="hljs-attr">"label"</span>: <span class="hljs-string">"Once per week"</span>},
    {<span class="hljs-attr">"label"</span>: <span class="hljs-string">"Twice per week"</span>}
  ]
}</code></pre><p>Example: General &#39;menu&#39; question with a mix of grouped responses</p>
<pre class="hljs"><code>SOFA::Question:{
  <span class="hljs-attr">"question"</span>: <span class="hljs-string">"What would you like me to do for you right now?"</span>,
  <span class="hljs-attr">"allowCustom"</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">"responses"</span>: [
    {
      <span class="hljs-attr">"label"</span>: <span class="hljs-string">"Trip"</span>,
      <span class="hljs-attr">"responses"</span>: [
        {<span class="hljs-attr">"label"</span>: <span class="hljs-string">"Directions"</span>, <span class="hljs-attr">"action"</span>: <span class="hljs-string">"Webview:/Directions"</span>},
        {<span class="hljs-attr">"label"</span>: <span class="hljs-string">"Timetable"</span>},
        {<span class="hljs-attr">"label"</span>: <span class="hljs-string">"Exit Info"</span>},
        {<span class="hljs-attr">"label"</span>: <span class="hljs-string">"Service Conditions"</span>, <span class="hljs-attr">"action"</span>: <span class="hljs-string">"Webview:/ServiceConditions"</span>}
      ]
    },
    {<span class="hljs-attr">"label"</span>: <span class="hljs-string">"Services"</span>},
    {<span class="hljs-attr">"label"</span>: <span class="hljs-string">"Nothing"</span>}
  ]
}</code></pre>    </article>
  </body>
</html>
